/*! Tag Select - v0.1.0 - 2017-08-15
* https://github.com/superhos/jquery-tag-select
* Copyright (c) 2017 SevensChan; Licensed MIT */
!function(a){a.fn.extend({tagSelect:function(a){var c=new b(this,a);return c.init()}});var b=function(b,c){this.$element=b,this.defaultSetting={maxNum:-1,inputCss:{height:"35px",minWidth:"80px",background:"#FFF"},dropdownCss:{},itemCss:{background:"#76d3ff"},existAnim:"swing",targetInput:"tags",separator:",",defaultItem:[]},this.setting=a.extend({},a.tag_select.options,options),this.targetInput=a("#"+this.setting.targetInput),this.inputbox=null,this.dropdown=null,this.tagList=[],"String"==typeof this.setting.defaultItem&&(this.setting.defaultItem=this.setting.defaultItem.join(",")),this.currentTagList=this.setting.defaultItem;var d=this;return this.initView=function(){var b='<div class="tag-select-input"></div>';this.$element.prepend(b),this.inputbox=a(".tag-select .tag-select-input"),this.inputbox.css(this.setting.inputCss);var c='<div class="tag-select-drop"></div>';this.$element.append(c),this.dropdown=a(".tag-select .tag-select-drop"),this.dropdown.css(this.setting.dropdownCss);var e='<div class="tag-select-item">{content}</div>',f=a(".tag-select ul li");a.each(f,function(b,c){var f=a(c).html();d.tagList.push(f),d.dropdown.append(e.replace("{content}",f))}),a(".tag-select.item").css(this.setting.itemCss),this.updateTagInputView(),this.bindEvent()},this.packageTag=function(a){var b='<div class="tag-select-item animated"><span>{content}</span><span class="close" data="{content}"></span></div>';return b.replace(/\{content\}/g,a)},this.bindEvent=function(){this.inputbox.click(this.switchDropDown),a(".tag-select-drop .tag-select-item").click(this.addTag),a(document.body).on("click",function(b){a(b.target).hasClass("tag-select-input")||a(b.target).hasClass("tag-select-item")||a(b.target).hasClass("close")||a(b.target).hasClass("tag-select-drop")||d.closeDropDown(b)}),a(document.body).on("mozAnimationEnd animationend webkitAnimationEnd oAnimationEnd",function(){a(".tag-select-item").removeClass(d.setting.existAnim)}),a(document.body).on("click",".tag-select-input .tag-select-item .close",this.removeTag)},this.switchDropDown=function(b){a(b.target).hasClass("tag-select-item")||a(b.target).hasClass("close")||(d.dropdown.is(":hidden")?d.dropdown.show():d.dropdown.hide())},this.closeDropDown=function(a){d.dropdown.hide()},this.checkIsExist=function(b){return-1!=a.inArray(b,this.currentTagList)},this.updateTagInputView=function(){a.each(d.currentTagList,function(a,b){d.inputbox.append(d.packageTag(b)),d.dropdown.css({top:d.inputbox.height()+6+"px",width:d.inputbox.width()+12+"px"}),d.updateValue()})},this.addTag=function(b){var c=a(b.target).html();if(d.checkIsExist(c))d.shakeTag(c);else{if(-1!=d.setting.maxNum&&d.currentTagList.length>=d.setting.maxNum)return void d.callOverflow();d.inputbox.append(d.packageTag(c)),d.currentTagList.push(c),d.dropdown.css({top:d.inputbox.height()+6+"px",width:d.inputbox.width()+12+"px"}),d.updateValue()}},this.updateValue=function(){this.targetInput.val(d.currentTagList.join(d.setting.separator))},this.shakeTag=function(b){a.each(a(".tag-select-input .tag-select-item span"),function(c,e){return a(e).html().trim()===b?void a(e).parent(".tag-select-item").addClass(d.setting.existAnim):void 0})},this.removeTag=function(b){var c=a(b.target).attr("data"),e=a(b.target).parent(".tag-select-item");a(e).remove(),d.currentTagList.splice(a.inArray(c,d.currentTagList),1),d.dropdown.css({top:d.inputbox.height()+6+"px",width:d.inputbox.width()+12+"px"}),d.updateValue()},this.callOverflow=function(){alert("最多只能選擇"+d.setting.maxNum+"個")},this.initView(),this};b.prototype={init:function(){return this.$element}}}(jQuery);